<view class="page" wx:if="{{loaded}}">
  <!-- 顶部图 -->
  <image class="hero" mode="aspectFill" src="{{product.imageUrl}}" />

  <view class="card">
    <view class="top">
      <view class="name">{{product.name}}</view>
      <view class="price">$ {{product.priceYuan}}</view>
    </view>
    <view class="desc" wx:if="{{product.description}}">{{product.description}}</view>
  </view>

  <!-- 配料表 -->
  <view class="card" wx:if="{{hasIngredients}}">
    <view class="section-title">配料表</view>
    <view class="chips">
      <view class="chip" wx:for="{{product.ingredients}}" wx:key="*this">{{item}}</view>
    </view>
  </view>

  <!-- 注意事项 -->
  <view class="card" wx:if="{{hasNotices}}">
    <view class="section-title">注意事项</view>
    <view class="notice" wx:for="{{product.notices}}" wx:key="*this">• {{item}}</view>
  </view>

  <!-- 选项区域 -->
  <view class="card">
    <view class="section-title">选项</view>

    <!-- 数量 -->
    <view class="row">
      <view class="label">数量</view>
      <view class="qty">
        <button class="qty-btn" size="mini" bindtap="decQty">-</button>
        <text class="qty-num">{{form.qty}}</text>
        <button class="qty-btn" size="mini" bindtap="incQty">+</button>
      </view>
    </view>

    <!-- 辣度 -->
    <view class="row" wx:if="{{hasSpice}}">
      <view class="label">辣度</view>
      <view class="wrap">
        <view
          class="opt {{form.spice===item ? 'active':''}}"
          wx:for="{{tpl.spiceLevels}}"
          wx:key="*this"
          data-val="{{item}}"
          bindtap="pickSpice"
        >
          {{item}}
        </view>
      </view>
    </view>

    <!-- 餐具 -->
    <view class="row" wx:if="{{hasCutlery}}">
      <view class="label">餐具</view>
      <view class="wrap">
        <view
          class="opt {{form.cutlery===item.code ? 'active':''}}"
          wx:for="{{cutleryUI}}"
          wx:key="code"
          data-val="{{item.code}}"
          bindtap="pickCutlery"
        >
          {{item.label}}
        </view>
      </view>
    </view>

    <!-- 加购项（多选） -->
    <view class="row" wx:if="{{hasAddons}}">
      <view class="label">加购项</view>
      <view class="wrap">
        <view
          class="opt {{item.selected ? 'active':''}}"
          wx:for="{{tpl.addons}}"
          wx:key="code"
          data-code="{{item.code}}"
          bindtap="toggleAddon"
        >
          {{item.name}} +$ {{item.priceYuan}}
        </view>
      </view>
    </view>

    <!-- 不要某配料（多选） -->
    <view class="row" wx:if="{{hasNoIngredients}}">
      <view class="label">不要</view>
      <view class="wrap">
        <view
          class="opt {{item.selected ? 'active':''}}"
          wx:for="{{tpl.noIngredients}}"
          wx:key="code"
          data-code="{{item.code}}"
          bindtap="toggleNoIng"
        >
          {{item.name}}
        </view>
      </view>
    </view>

    <!-- 备注（仅选项，不自由输入） -->
    <view class="row" wx:if="{{hasRemarks}}">
      <view class="label">备注</view>
      <view class="wrap">
        <view
          class="opt {{item.selected ? 'active':''}}"
          wx:for="{{tpl.remarks}}"
          wx:key="code"
          data-code="{{item.code}}"
          bindtap="toggleRemark"
        >
          {{item.name}}
        </view>
      </view>
    </view>

    <!-- 小计 -->
    <view class="row total">
      <view class="label">小计</view>
      <view class="sum">$ {{summary.totalYuan}}</view>
    </view>
  </view>

  <!-- 底部按钮 -->
  <view class="bottom">
    <button class="btn" bindtap="addToCartTap">加入购物车</button>
  </view>
</view>

<view wx:else class="loading">加载中...</view>
